<script type="text/javascript" src="https://code.jquery.com/jquery-3.5.1.min.js"></script>

<style type="text/css">
	body {
		background-color: #4d80BE;
	}

	#main-body {
  		display: grid;
		align-items: center;
  		justify-content: center;
	}
	.cell {
		background-color: #c5a336;
		width: 50px; 
		height: 50px;
		display: inline-block;
		margin: 15px;
		color: red;
		text-align: center;
		vertical-align: middle;
		line-height: 50px;	
		font-size: 35px;
		cursor: pointer;
		border: solid 1px #c5a336;
	}

	.cell.selected, .cell.removed {
		border: solid 1px black;
		color: white;
	}

	.column {
		display: inline-block;
		width: 80px;
	}

	.line {
		width: 100%;
		height: 2px;
		background-color: grey;
	}

	#reveal-row .cell {
		color: white;
	}

	#reveal-row .cell.final {
		color: white;
		border: solid 1px white;
	}

	#controls {
		width: 100%;
		text-align: center;
	}

	#controls button {
		display: inline-block;
		padding: 10px;
		margin: 0 15px;
	}

	#background-image {
		transform: rotate(-45deg);
		background-image: url(cool-text.png);
		background-repeat: no-repeat;
		height: 300px;
		width: 400px;
		position: absolute;
		background-position: 0px 55px;
		z-index: -100;
	}

</style>
<script type="text/javascript">
	var globalDigits = 5
	var globalPrice = 50198

	function generateRandom(numbersToChoose, chosenNumbers) {
		for (var i = 0; i < numbersToChoose-1; i++) {
			var newRandomNumber = chosenNumbers[0]
			do {
				newRandomNumber = getRandomInt(0, 9)
			} while (chosenNumbers.includes(newRandomNumber));
			chosenNumbers.push(newRandomNumber)
		}

		return shuffle(chosenNumbers)
	}

	function shuffle(a) {
	    var j, x, i;
	    for (i = a.length - 1; i > 0; i--) {
	        j = Math.floor(Math.random() * (i + 1));
	        x = a[i];
	        a[i] = a[j];
	        a[j] = x;
	    }
	    return a;
	}

	function getRandomInt(min, max) {
    	min = Math.ceil(min);
    	max = Math.floor(max);
    	return Math.floor(Math.random() * (max - min + 1)) + min;
	}

	function generateGame() {
		generateRevealRow()
		var splitNumber = globalPrice.toString().split("").map(x => parseInt(x))
		var numbers = 2;
		$("#game-cells").append($("<div>", {"id": "background-image"}))
		for (var i = 0; i < globalDigits; i++) {
			$("#game-cells").append($("<div>", {'class': 'column'}))
			var generatedNumbers = generateRandom(numbers, [splitNumber[i]])
			for (var j = 0; j < numbers; j++) {
				$($("#game-cells .column")[i]).append(
					$("<span>", {'class': 'cell'})
						.text(generatedNumbers[j])
						.data('number', generatedNumbers[j])
						.data('column', i)
				)
			}
			numbers += 1;
		}
	}

	function generateRevealRow() {
		for (var i = 0; i < globalDigits; i++) {
			$("#reveal-row").append($("<span>", {'class': 'cell'}))
		}
	}
	
	$(function() {
		generateGame()
		startListening()
		setupButtons()
	});

	function newGame() {
		$("#reveal-row").empty()
		$("#game-cells").empty()
		generateGame()
		startListening()
	}

	function setupNewMove() {
		$("#game-cells .selected").addClass("removed").removeClass("selected")
	}

	function setupButtons() {
		$("#guess-button").click(function() {
			if ($("#reveal-row .cell.selected").length != globalDigits) {
				alert("Please choose more numbers")
				return
			}

			var foundCorrectNumber = false
			var splitNumber = globalPrice.toString().split("").map(x => parseInt(x))
			for (var i = 0; i < globalDigits; i++) {
				var $cell = $($("#reveal-row .cell")[i])
				var numberChosen = parseInt($cell.text())
				console.log("Comparing " + splitNumber + " and number chosen " + numberChosen)
				if (splitNumber[i] == numberChosen) {
					console.log("row at " + i + " is correct!")
					if (!$cell.hasClass("final")) {
						$cell.addClass("final")
						foundCorrectNumber = true
					}
				} else {
					$cell.text("")
					$cell.removeClass("selected")
				}
			}

			if ($("#reveal-row .cell.final").length == globalDigits) {
				alert("YOU WIN")
			} else if (foundCorrectNumber) {
				setupNewMove()
			} else {
				alert("You lose! Tap reset!")
			}
		})

		$("#reset-button").click(function() {
			newGame()
		})
	}
	function startListening() {
		$("#game-cells .cell").click(function() {
			var $this = $(this)
			var column = $(this).data('column')

			var revealCell = $($("#reveal-row .cell")[column])
			if (revealCell.hasClass("final")) {
				console.log("Column has already has a correct number")
				return
			}

			if ($this.parent().find(".selected").length != 0) {
				$this.parent().find(".selected").removeClass('selected')
			}

			$this.addClass("selected");
			console.log("selecting " + $this.text())
			revealCell.text($this.text())
			revealCell.addClass("selected")
		})
	}

	
</script>

<body>
	<div id="main-body">
		<div id="game-cells">
		</div>
		<br>
		<div class="line"></div>
		<br>
		<div id="reveal-row"></div>
		<br>
		<br>
		<br>
		<div id="controls">
			<button id="guess-button">Guess!</button>
			<button id="reset-button">Reset</button>
		</div>
	</div>
</body>